# This work flow will create a tag when merging to main
name: Generate Release

on:
  pull_request:
    branches:
      - stage
    
env:
  VERSION_FILE: version.properties
  VERSION_EXTRACT_PATTERN: '(?<=VERSION_NUMBER=).+'
  
jobs:
  Generate_Release:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout branch
        uses: actions/checkout@v3
      - uses: HardNorth/github-version-generate@v1.1.1
        with:
          version-source: file
          version-file: ${{ env.VERSION_FILE }}
          version-file-extraction-pattern: ${{ env.VERSION_EXTRACT_PATTERN }}
      - name: Create tag
        uses: rickstaa/action-create-tag@v1
        with:
          tag: "v${{ env.CURRENT_VERSION }}"
      - name: Generate Changelog
        steps:
          - uses: actions/checkout@v2
            with:
              fetch-depth: 50
          - uses: fregante/release-with-changelog@v3
            with:
              token: ${{ secrets.GITHUB_TOKEN }}
              exclude: '^Meta'
                commit-template: '- {title} ← {hash}'
                template: |
                  ### Changelog
                  
                  {commits}
                  
                  {range}
                  
                  ❤
